@page "/admin/removeprofessorclass"
@inject ProtectedLocalStorage storage
@inject NavigationManager navigate
@inject ISnackbar snackbar

<h3>Remove professor from class</h3>

<MudTextField @bind-Value="CRN" Label="CRN" Variant="Variant.Outlined"></MudTextField>
<MudButton @onclick="submitForm" Variant="Variant.Outlined" Color="Color.Success">submit</MudButton>



@code
{
    Mongo mongo = new Mongo("college-site-2");
    Theme theme = new Theme();
    private static string CRN { get; set; }

    protected override async Task OnInitializedAsync()
    {
        try
        {
            var accountTypeCheck = await storage.GetAsync<string>("accountType");

            if (accountTypeCheck.Value != "Admin")
            {
                navigate.NavigateTo("/homepage");
            }
        }
        catch
        {
            navigate.NavigateTo("/homepage");
        }
    }


    private void submitForm()
    {
        try
        {
            bool validForm = true;

            if (CRN == null && CRN == "")
            {
                validForm = false;
            }


            //sanity check

            bool sanityCheck = true;

            if (validForm)
            {
                var queryClassID = mongo.LoadRecordByString<Classes>("classes", "CRN", CRN);

                //this if statement might need to be reworked, i'm not exactly sure
                //how dates work in terms of compairison operator -Nick
                if (queryClassID.StartDate.ToLocalTime() > DateTime.Today.ToLocalTime())
                {
                    sanityCheck = false;
                }
            }


            if (validForm && sanityCheck)
            {
                var queryClassesID = mongo.LoadRecordByString<Classes>("classes", "CRN", CRN);

                queryClassesID.ProfessorName = "none none";
                queryClassesID.ProfFirstName = "none";
                queryClassesID.ProfLastName = "none";

                mongo.UpsertRecord<Classes>("classes", queryClassesID.Id, queryClassesID);
            }
            else
            {
                snackbar.Add("Professor was not removed successfully", Severity.Error);
            }

        }
        catch
        {
            snackbar.Add("Professor was not removed successfully", Severity.Error);
        }

    }
}